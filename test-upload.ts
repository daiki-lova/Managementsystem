import "dotenv/config";
import { supabaseAdmin, uploadImage } from "./src/lib/supabase";

async function testUpload() {
  console.log("SUPABASE_URL:", process.env.SUPABASE_URL);
  console.log("Service key exists:", !!process.env.SUPABASE_SERVICE_ROLE_KEY);

  // シンプルなテスト画像（1x1 PNG）
  const testPng = Buffer.from([
    0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a,
    0x00, 0x00, 0x00, 0x0d, 0x49, 0x48, 0x44, 0x52,
    0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01,
    0x08, 0x02, 0x00, 0x00, 0x00, 0x90, 0x77, 0x53,
    0xde, 0x00, 0x00, 0x00, 0x0c, 0x49, 0x44, 0x41,
    0x54, 0x08, 0xd7, 0x63, 0xf8, 0xff, 0xff, 0x3f,
    0x00, 0x05, 0xfe, 0x02, 0xfe, 0xdc, 0xcc, 0x59,
    0xe7, 0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4e,
    0x44, 0xae, 0x42, 0x60, 0x82
  ]);

  try {
    const result = await uploadImage(
      "MEDIA",
      `test/test-${Date.now()}.png`,
      testPng,
      "image/png"
    );
    console.log("Upload successful:", result);
  } catch (error) {
    console.error("Upload failed:", error);
  }
}

testUpload();
