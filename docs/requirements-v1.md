# 要件定義書（完全版・v1）

**対象：ヨガメディア運用「管理・分析・記事生成システム」**

前提：フロントデザイン（Figma/現フロント実装）は原則変更しない。必要な差分のみ本書で定義する。

---

## 1. 目的とゴール

本システムの最終ゴールは「ヨガのオンラインスクール説明会への参加」を増やすことです。

ただし v1 は二段階マーケティングの前半に集中し、**SEO流入の最大化**と、**価値の高いSEO記事の量産・改善を回すための基盤**を作ります。

v1 の分析は「最終申込数」ではなく、記事ごとのオーガニック流入と**説明会ページへの遷移（到達）**を主要な評価対象とします。

---

## 2. スコープ（v1でやる／やらない）

### 2.1 v1でやる

- 記事の作成・編集・削除、下書き／予約／即時公開の運用
- キーワード選定と検索ボリューム取得（日本・月間）
- 情報バンク（一次情報）を使った記事生成
- 監修者（専門性・トーン）とコンバージョン（訴求コンテキスト）を使った記事生成
- メディア管理（画像ライブラリ、記事内画像、圧縮、WebP化）
- GA（Google Analytics）API、Search Console API、検索ボリュームAPIの取り込み（1日1回）
- 生成処理は外部ワークフロー（例：Inngest）で分割・並列実行し、フロントは進捗を表示する

### 2.2 v1でやらない

- パスワードリセット機能
- 二段階認証
- ステージング環境（Vercelのブランチプレビューで代替）
- 記事のバージョン履歴（差分・巻き戻し）
- 操作ログ（誰が何をしたかの監査ログ）
- データエクスポート（CSV/Markdown/JSON 等）
- スマホでのフル操作（スマホは統計閲覧のみ）

---

## 3. 利用者・権限

### 3.1 ロール

オーナー（管理者）とライター（編集担当）の2ロール。

### 3.2 権限方針（確定事項）

ライターは「記事管理を全部」できます。具体的には記事の作成・編集・削除、AI記事生成、メディア利用（アップロード、AI画像の保存など）まで許可します。

ただし「システム的に重要な設定」はオーナーのみが変更できます。

**オーナーのみ（確定）**
- 監修者の「システムプロンプト（専門性・トーンの指定）」の編集

**オーナーのみ（v1方針）**
- 外部連携設定（GA/SC/ボリュームAPIのキーなど）
- システム設定（ボリュームゾーンなど）

---

## 4. 対応端末

- PCブラウザを前提にフル機能を提供します
- スマホは「ダッシュボードトップの統計閲覧のみ」とし、その他操作はPCで行います

---

## 5. 画面・機能要件（UIは既存前提で挙動を定義）

### 5.1 認証（ログイン）

- ログイン方式はメールアドレス＋パスワードのみ
- パスワードリセットは不要
- クライアント運用前提で、過度な認証機能は持たない

### 5.2 記事管理（一覧／作成／編集／削除／公開）

記事は少なくとも以下を持ちます：
- タイトル
- 本文
- カテゴリ（1つ）
- タグ（複数）
- アイキャッチ
- 差し込み画像（最大2枚）
- スラッグ（英語）
- コンバージョン（複数可）
- 監修者
- 公開状態（下書き／予約／公開）
- 公開日時（予約の場合）

記事の編集は「全部編集可能」です。タイトル、本文、画像、カテゴリ、タグ、コンバージョン、監修者、公開日時、スラッグ、メタ情報を含みます。

予約中の記事は予約解除して下書きに戻せます。

記事の本文要素はテキスト、画像、リンク、iframe埋め込みを許可します。iframeは基本どのドメインでも許可します（ホワイトリスト制は採用しない）。

### 5.3 カテゴリ・タグ

- カテゴリは1記事につき1つのみ
- タグは無制限
- タグで記事を検索・絞り込みできることが必須です（フロント調整含む）

### 5.4 メディア（画像）要件

#### 5.4.1 記事側の画像

- アイキャッチ画像は必須。比率は16:9
- OGPはアイキャッチと同一でよい（別設定不要）
- 差し込み画像はアイキャッチ以外で最大2枚
- 画像は表示速度を優先し、劣化が目立たない範囲で自動圧縮・最適化する

#### 5.4.2 画像ライブラリ（保存と再利用）

画像はライブラリに保存され、再利用できる状態を基本とします。

ただしAI生成画像は大量に増えやすいので、以下のルールで制御します。

**「手動アップロード画像」**
- 原則ライブラリに保存し、一覧から選べる

**「AI生成画像」**
- 記事に採用した画像は、記事の資産として必ず保存する
- ただしデフォルトではライブラリ一覧に出さない
- ユーザーが明示的に「ライブラリに保存」をした場合のみ一覧に出す

**「採用しなかったAI候補」**
- 破棄でよい（候補管理は基本しない。サムネ＋差し込み程度の想定）

#### 5.4.3 削除の扱い（確定事項）

- ライブラリから画像を「削除」しても、記事からは削除しない。記事表示を壊さないことが絶対条件
- さらに、記事で使われていない画像であっても物理削除はしない（残しておく）
- v1の削除は実質「ライブラリ一覧から外す（非表示化）」として扱います

#### 5.4.4 整理

- 基本はタグで整理します。タグ検索・絞り込みができる前提にします
- フォルダ階層はv1では必須にしません

#### 5.4.5 アップロード上限・形式・変換

- アップロード上限は1ファイル10MB
- 受け付け形式は JPG/PNG/WebP
- 保存時は原則WebPに自動変換し、圧縮・最適化します

#### 5.4.6 画像のSEO属性

- 画像の alt テキストとファイル名はAIが自動生成します
- ユーザーは後から編集可能です
- 生成は記事内容とキーワードを参照し、内容に沿った自然な文言にします

---

## 6. コンバージョン（訴求）要件

- 記事はコンバージョンを複数選択可能です
- 優先度（主従）は付けず同列扱い
- コンバージョン定義は少なくとも以下を持ちます：
  - 名称
  - 種類
  - ステータス
  - 遷移先URL
  - サムネイル
  - 期間（任意）
- 最重要項目として「コンテキスト（AI生成用）」を持ち、記事生成時に必ず参照します

### 6.1 訴求の差し込み（AIに任せる＋上限だけ固定）

- バナーだけでなく、テキストリンク等の形式も許可します
- どこに、どの形式で差し込むかはAIが本文を見て決定します
- ただし上限は固定します：
  - **1記事あたりのCTA合計は最大5回まで**
  - **そのうちバナー型CTAは最大2回まで**

CTAクリックは計測対象にし、記事単位で説明会ページへの遷移数（到達）として集計できるようにします（実装は「クリック計測（イベント）」を推奨）。

---

## 7. 監修者要件（専門性・トーン）

- 監修者はプロフィール情報を持ちます：
  - 名前
  - 肩書き
  - 資格
  - 自己紹介
  - 画像
  - SNS等
- 最重要として「システムプロンプト（専門性・トーンの指定）」を持ちます
- 記事生成時には監修者プロンプトを必ず参照し、語り口・専門性・根拠の出し方を統一します

**監修者のシステムプロンプト編集はオーナーのみ。**

---

## 8. 情報バンク（一次情報）要件（追加の核）

### 8.1 目的

情報バンクは「お客様の声」「体験談」「事例」「講座・コースの具体情報」など、一次情報を蓄積する場所です。

記事生成はキーワードだけで書くのではなく、情報バンクの一次情報を材料に深掘りした記事を作ります。

### 8.2 情報バンクの属性

- 情報バンク項目は、ブランド、情報の種類、監修者、コースを持ちます（紐づけ・検索条件として使う）
- 内容はテキストまたはURLで登録できます

### 8.3 URL登録の扱い（確定）

- URLを登録した場合、登録時点でページ本文を自動取得し、情報バンク内にテキストとしてスナップショット保存します
- 記事生成時は保存されたテキストを一次情報として参照します（生成のたびに外部サイトへ取りに行かない）
- 必要な場合のみ、手動で「再取得（更新）」できる設計を推奨します（v1では自動更新不要）

### 8.4 記事生成での利用ルール

- 記事生成時は、選択された監修者（必須）と、必要ならブランド・コース等の条件を用いて情報バンクを検索し、該当キーワードに関連する一次情報を抽出してから執筆に入ります
- 生成された記事には「参照した情報バンク項目」を内部的に紐づけて保持し、情報バンク側には使用回数を持たせてよいです（運用での管理用途）

### 8.5 引用の扱い（確定）

- 情報バンクの原文は、そのまま引用して使ってよい
- AIには「必要に応じて原文引用＋要約・言い換えを混ぜる」方針で書かせます

---

## 9. キーワード分析・記事生成（v1：手動実行）

### 9.1 実行の流れ（確定）

1. ユーザーが管理画面で、カテゴリ、コンバージョン、監修者を選ぶ
2. その上でキーワードを選定する
3. AIがキーワードを分析し、日本の月間検索ボリュームを取得して提示する
4. ユーザーはキーワードを選び、キーワード1つにつき最大5本の記事を生成できる

### 9.2 表示する指標（確定）

- キーワード一覧に出すのは「キーワード」と「検索ボリューム」のみ
- 難易度スコアや優先度スコアは採用しない（ロジック曖昧なため）
- 検索ボリュームのボリュームゾーンや下限はシステム設定で変更可能にする（固定値にしない）

### 9.3 公開設定（確定）

- 記事生成のタイミングで、生成バッチ全体に対して「下書き／即時公開／予約投稿」を選ぶ
- 予約投稿の日時は生成画面では一括指定のみ
- 個別の日時調整は生成後に記事管理画面で行う

### 9.4 品質チェック（確定）

- 品質チェック（タイトル・見出し構造・文字数・内部リンク・画像設定・キーワード配置等）は行ってよいが、v1では公開をブロックしない
- 警告・参考情報として扱う
- 品質を担保する主戦略はプロンプトの練り上げで進める

---

## 10. 分析（GA/SC/ボリュームAPI）

- 外部連携はGA API、Search Console API、検索ボリュームAPIを導入する
- 取り込みは毎日1回でよい
- クライアント担当者はグラフ分析を細かく見る前提ではなく、分析データは「生成・改善の材料」として使う
- v1 の主要な見方は、記事ごとのオーガニック流入と、CTAクリック（説明会ページへの遷移数）です

---

## 11. 生成処理基盤（タイムアウト回避）

- 生成処理はフロント同期ではなく、外部ワークフロー基盤（例：Inngest）で分割・並列実行します
- フロントは進捗（ステップ名＋進捗バー）を表示すればよく、詳細ログは必須ではありません
- 失敗時は再実行できることを優先し、途中成果物は下書きとして残せる設計を推奨します

---

## 12. 非機能要件

- v1はまず50本程度で精度を高めるが、将来は500〜1000本、PV 1万〜10万超も見据える
- そのため、記事一覧・検索・タグ絞り込み・日次取り込みはスケールしても破綻しない構造とする
- バックアップは推奨構成（例：日次バックアップ＋一定期間保持）を採用する

---

## 13. デプロイ・運用

- ホスティングはVercel
- ステージングは不要。検証はブランチのプレビューで行う

---

## 14. データモデル（実装のための最低限）

実装をブレさせないため、最低限の「概念」と「関係」だけ確定します。

### Article（記事）
- カテゴリ1つ
- タグ複数
- 監修者1人
- コンバージョン複数
- 画像（アイキャッチ1＋差し込み最大2）

### MediaAsset（画像）
- 実体は常に保存される
- ライブラリ表示はフラグで制御する
  - 手動アップは表示
  - AI画像はデフォルト非表示
  - 削除は非表示化

### KnowledgeItem（情報バンク）
- ブランド・種類・監修者・コースを持つ
- 内容（テキスト）を保存する
- URLは登録時に本文抽出して保存する

### GenerationJob（生成ジョブ）
- キーワード・監修者・コンバージョン・カテゴリ・情報バンク参照を入力として保持
- 生成結果の記事群と紐づく

---

以上が、現時点で合意できている内容をすべて統合した v1 の「完全版」要件定義書です。

このままフロント実装に進めます（UIは既存準拠、必要差分はタグ検索などの挙動面中心）。
