# 記事生成パイプライン V3 設計書

## コンセプト

**一次情報が主役、キーワードは入口**

従来のキーワード起点ではなく、受講生の体験談（一次情報）を主役とした記事生成。
このメディアだからこそ出せる独自の価値を最大化する。

## フロー概要

```
1. 受講生の声を選択
   ↓
2. テーマ・キーワード候補を抽出（AI）
   ↓
3. キーワードのフィルタリング
   - DataForSEOでボリューム取得
   - 既存記事との重複排除
   - 最適なキーワードを選択
   ↓
4. 記事生成
   - 受講生の体験を深掘り・膨らませる
   - 監修者の視点を加える
   - 他の受講生の声を補助的に散りばめる
   - キーワードを自然に織り込む
   ↓
5. メタ情報・画像生成
   ↓
6. 下書き保存
```

## 詳細設計

### Step 1: 受講生の声を選択

**入力**: なし（自動選択）または指定ID

**処理**:
- 未使用の受講生の声（STUDENT_VOICE）から選択
- 優先順位: 文字数が多いもの（情報量が多い）

**出力**: 選択した受講生の声のデータ

---

### Step 2: テーマ・キーワード候補抽出

**入力**: 受講生の声

**処理（AI）**:
- 体験の主要テーマを抽出
- そのテーマで狙えるSEOキーワードを10〜15個提案
- 各キーワードの想定検索意図も出力

**プロンプト例**:
```
この受講生の体験談を分析し、以下を出力してください：

1. 体験の主要テーマ（3つ程度）
2. このテーマで狙えるSEOキーワード候補（10〜15個）
   - キーワード
   - 想定検索ボリューム（高/中/低）
   - 検索意図
```

**出力**: テーマリスト、キーワード候補リスト

---

### Step 3: キーワードフィルタリング

**入力**: キーワード候補リスト

**処理**:
1. DataForSEO APIで各キーワードの検索ボリュームを取得
2. 既存記事（generation_jobs.keyword）との重複チェック
3. ボリューム順にソート
4. 最適な1つを選択

**出力**: 選択されたキーワード、ボリューム情報

---

### Step 4: 記事生成

**入力**:
- メインの受講生の声
- 選択されたキーワード
- 監修者情報
- 補助的な他の受講生の声（2〜3件）
- コンバージョン情報

**処理（AI）**:
一次情報ベースの記事を生成

**記事構成の方針**:

```
【SEO・LLMO最適化を考慮した構成】

1. リード文
   - 読者の悩み・共感ポイント
   - この記事で得られること

2. メインストーリー（受講生の体験）
   - きっかけ・動機（膨らませてOK）
   - 受講中の体験・気づき
   - 成果・変化

3. 監修者の視点
   - この体験に対するコメント
   - 専門家としての補足
   - よく使うフレーズを自然に入れる

4. 他の受講生の声（補助）
   - 「同じような体験をした方も...」

5. 実践的な情報
   - キーワードに関連するハウツー要素
   - 具体的なステップ・アドバイス

6. よくある質問（FAQ）
   - 構造化データ対応
   - LLMO対策（AIに引用されやすい形式）

7. まとめ・CTA
   - 体験談のポイント整理
   - コンバージョンへの誘導

【CTA配置】
- 記事中盤（ストーリーの山場後）
- 記事末尾
- 適切な誘導文を添える
```

**監修者の活用方法**:
- エピソードを引用
- よく使うフレーズを自然に入れる
- 避ける言葉は使わない
- ライティングスタイル（casual）を反映

**膨らませのルール**:
- 個人が特定されない範囲でOK
- 自然に推測できる範囲で補完
- 感情や心情の描写を追加

---

### Step 5: メタ情報・画像生成

**メタタイトル**:
- 32文字以内
- キーワードを前方に
- 体験要素を含める

**メタディスクリプション**:
- 120〜140文字
- 体験談であることをアピール
- 検索意図に応える

**画像**:
- カバー画像（16:9）
- 本文中画像（2枚程度）
- 体験のイメージに合った画像

---

### Step 6: 下書き保存

従来と同様

---

## データベース変更

### generation_jobs テーブル

新規フィールド（検討）:
- `primaryKnowledgeItemId`: メインの受講生の声のID
- `generationType`: 'KEYWORD_BASED' | 'PRIMARY_INFO_BASED'

---

## 期待される効果

1. **独自性**: 他メディアにない一次情報ベースの記事
2. **SEO**: キーワードはしっかり狙いつつ、コンテンツの質で勝負
3. **LLMO**: 構造化された情報がAIに引用されやすい
4. **再現性**: 受講生の声の数だけ記事が作れる
5. **バリエーション**: 同じキーワードでも違う切り口の記事

---

## 実装優先度

1. Step 2: キーワード候補抽出（新規）
2. Step 3: キーワードフィルタリング（新規）
3. Step 4: 記事生成プロンプト（大幅変更）
4. Step 5: メタ・画像（既存流用＋調整）
5. Step 6: 保存（既存流用）
